<%- include('partials/header') %>

<h1>Nuevo Despacho</h1>

<form action="/dispatches/new" method="GET">
  <div class="form-group">
    <label for="order_id">Selecciona Pedido:</label>
    <select name="order_id" id="order_id" class="form-control" onchange="this.form.submit()">
      <option value="">— Elige un pedido —</option>
      <% orders.forEach(o => { %>
        <option
          value="<%= o.order_id %>"
          <%= (o.order_id == selectedOrder) ? 'selected' : '' %>>
          Pedido #<%= o.order_id %> — <%= o.client_name %>
        </option>
      <% }) %>
    </select>
  </div>
</form>

<% if (palettes.length) { %>
  <form action="/dispatches/new" method="POST">
    <input type="hidden" name="order_id" value="<%= selectedOrder %>"/>

    <h2>Paletas del Pedido #<%= selectedOrder %></h2>
    <div class="form-group">
      <% palettes.forEach(p => { %>
        <div class="checkbox">
          <label>
            <input type="checkbox" name="pallets" value="<%= p.numero_paleta %>"/>
            Paleta #<%= p.numero_paleta %> (estado: <%= p.estado %>)
          </label>
        </div>
      <% }) %>
    </div>

    <!-- Nuevos campos -->
    <div class="form-group">
      <label for="transportista">Transportista:</label>
      <input type="text" id="transportista" name="transportista" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="container_number">Número de Contenedor:</label>
      <input type="text" id="container_number" name="container_number" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="puerto_destino">Puerto de Destino:</label>
      <input type="text" id="puerto_destino" name="puerto_destino" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="pais_destino">País de Destino:</label>
      <input type="text" id="pais_destino" name="pais_destino" class="form-control" required>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-success">Crear Despacho</button>
      <a href="/dispatches" class="btn btn-secondary">Cancelar</a>
    </div>
  </form>
<% } %>

<%- include('partials/footer') %>
